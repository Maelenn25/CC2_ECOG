---
title: "R Notebook"
output: 
  github_document:
    toc: true
    toc_depth: 2
---

```{r}
library (phyloseq)
library(ggplot2)
library (dada2)
```

#création variable
```{r}
path <- "~/CC2_ECOG/sequences_reunies" # CHANGE ME to the directory containing the fastq files after unzipping.
list.files(path)
```
## filtration et retirage des sequences basse qualité
```{r}
# Sort ensures forward/reverse reads are in same order
fnFs <- sort(list.files(path, pattern="_R1.fastq"))
fnRs <- sort(list.files(path, pattern="_R2.fastq"))
# Extract sample names, assuming filenames have format: SAMPLENAME_XXX.fastq
sample.names <- sapply(strsplit(basename(fnFs), "R"), `[`,1)
# Specify the full path to the fnFs and fnRs
fnFs <- file.path(path, fnFs)
fnRs <- file.path(path, fnRs)
print(fnRs)
```

```{r}
fnRs[1:11]
```

```{r}
plotQualityProfile(fnFs[1:3])
```



```{r}
plotQualityProfile(fnRs[1:2])
```

```{r}
# Place filtered files in filtered/ subdirectory
filtFs <- file.path(path, "filtered", paste0(sample.names, "_F_filt.fastq.gz"))
filtRs <- file.path(path, "filtered", paste0(sample.names, "_R_filt.fastq.gz"))
names(filtFs) <- sample.names
names(filtRs) <- sample.names
sample.names
print(filtFs)
```

```{r}
out<-filterAndTrim(fnFs, filtFs, fnRs, filtRs, truncLen=c(210,200),trimLeft=c(21),
              maxN=0, maxEE=c(2,2), truncQ=2, rm.phix=TRUE,
              compress=TRUE, multithread=TRUE) # On Windows set multithread=FALSE
```

```{r}
head(out)
```
# Learn the Error Rates
 Nous allons ici utiliser des lignes de commandes qui vont permettre d'apprendre à la machine les différents profils d'erreurs générées lors du séquençage. L'opération est faite sur les deux types de séquence.
 
```{r}
errF <- learnErrors(filtFs, multithread=TRUE)
```

```{r}
errR <- learnErrors(filtRs, multithread=TRUE)
```
Chaque transition (mutation) possible (A→C, A→G, ...) le taux d'erreur sont indiqués. 
-points : les taux d'erreur observés pour chaque score de qualité du consensus. 
-ligne noire : taux d'erreur estimés après convergence de l'algorithme d'apprentissage machine. 
-ligne rouge : taux d'erreur attendus selon la définition nominale du Q-score.
```{r}
plotErrors(errF, nominalQ=TRUE)
```
```{r}
plotErrors(errR, nominalQ=TRUE)
```

